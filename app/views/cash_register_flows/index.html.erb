<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">
        Flujos de Efectivo
      </h1>
      <p class="mt-1 text-sm text-gray-600">
        <%= @register_session.display_name %>
      </p>
    </div>
    
    <% if policy(@register_session).manage_flows? && @register_session.open? %>
      <%= link_to new_register_session_cash_register_flow_path(@register_session),
          class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" do %>
        <svg class="-ml-1 mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
        Nuevo Movimiento
      <% end %>
    <% end %>
  </div>

  <!-- Estad√≠sticas -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <!-- Total Ingresos -->
    <div class="bg-green-50 border-2 border-green-200 rounded-lg p-4">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <span class="text-3xl">‚ûï</span>
        </div>
        <div class="ml-3 flex-1">
          <p class="text-sm font-medium text-green-800">Total Ingresos</p>
          <p class="text-2xl font-bold text-green-900">
            $<%= number_with_precision(@stats[:total_inflows], precision: 2, delimiter: ',') %>
          </p>
          <p class="text-xs text-green-700 mt-1">
            <%= @stats[:inflows_count] %> <%= @stats[:inflows_count] == 1 ? 'movimiento' : 'movimientos' %>
          </p>
        </div>
      </div>
    </div>

    <!-- Total Egresos -->
    <div class="bg-red-50 border-2 border-red-200 rounded-lg p-4">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <span class="text-3xl">‚ûñ</span>
        </div>
        <div class="ml-3 flex-1">
          <p class="text-sm font-medium text-red-800">Total Egresos</p>
          <p class="text-2xl font-bold text-red-900">
            $<%= number_with_precision(@stats[:total_outflows], precision: 2, delimiter: ',') %>
          </p>
          <p class="text-xs text-red-700 mt-1">
            <%= @stats[:outflows_count] %> <%= @stats[:outflows_count] == 1 ? 'movimiento' : 'movimientos' %>
          </p>
        </div>
      </div>
    </div>

    <!-- Balance Neto -->
    <div class="<%= @stats[:net_flow] >= 0 ? 'bg-blue-50 border-blue-200' : 'bg-orange-50 border-orange-200' %> border-2 rounded-lg p-4">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <span class="text-3xl"><%= @stats[:net_flow] >= 0 ? 'üí∞' : '‚ö†Ô∏è' %></span>
        </div>
        <div class="ml-3 flex-1">
          <p class="text-sm font-medium <%= @stats[:net_flow] >= 0 ? 'text-blue-800' : 'text-orange-800' %>">
            Balance Neto
          </p>
          <p class="text-2xl font-bold <%= @stats[:net_flow] >= 0 ? 'text-blue-900' : 'text-orange-900' %>">
            <%= @stats[:net_flow] >= 0 ? '+' : '' %>$<%= number_with_precision(@stats[:net_flow], precision: 2, delimiter: ',') %>
          </p>
          <p class="text-xs <%= @stats[:net_flow] >= 0 ? 'text-blue-700' : 'text-orange-700' %> mt-1">
            <%= @stats[:flows_count] %> <%= @stats[:flows_count] == 1 ? 'movimiento total' : 'movimientos totales' %>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla de flujos -->
  <div class="bg-white shadow-sm rounded-lg overflow-hidden">
    <% if @flows.any? %>
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Fecha/Hora
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Tipo
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Monto
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Descripci√≥n
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Creado por
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Autorizado por
            </th>
            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
              Acciones
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @flows.each do |flow| %>
            <tr class="<%= flow.cancelled? ? 'bg-gray-100 opacity-60' : 'hover:bg-gray-50' %>">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= l(flow.created_at, format: :short) %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-<%= flow.badge_color %>-100 text-<%= flow.badge_color %>-800">
                  <%= flow.icon %> <%= flow.type_name %>
                </span>
                <% if flow.cancelled? %>
                  <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    ‚ùå Cancelado
                  </span>
                <% end %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold <%= flow.inflow? ? 'text-green-600' : 'text-red-600' %>">
                <%= flow.sign %>$<%= number_with_precision(flow.amount, precision: 2, delimiter: ',') %>
              </td>
              <td class="px-6 py-4 text-sm text-gray-900">
                <%= truncate(flow.description, length: 60) %>
                <% if flow.cancelled? %>
                  <div class="mt-1 text-xs text-gray-600">
                    <strong>Cancelado:</strong> <%= flow.cancellation_reason %>
                  </div>
                <% end %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                <%= flow.created_by.name %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                <%= flow.authorized_by.name %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <% if !flow.cancelled? && policy(flow).edit? %>
                  <%= link_to edit_register_session_cash_register_flow_path(@register_session, flow),
                      class: "text-blue-600 hover:text-blue-900 mr-3" do %>
                    Editar
                  <% end %>
                <% end %>
                
                <% if !flow.cancelled? && policy(flow).cancel? %>
                  <%= button_to cancel_register_session_cash_register_flow_path(@register_session, flow),
                      method: :post,
                      form: { data: { turbo_confirm: "¬øEst√° seguro de cancelar este movimiento?" } },
                      params: { cancellation_reason: "Cancelado por #{current_user.name}" },
                      class: "text-red-600 hover:text-red-900" do %>
                    Cancelar
                  <% end %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <div class="text-center py-12">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No hay movimientos</h3>
        <p class="mt-1 text-sm text-gray-500">No se han registrado ingresos ni egresos en este turno.</p>
        <% if policy(@register_session).manage_flows? && @register_session.open? %>
          <div class="mt-6">
            <%= link_to new_register_session_cash_register_flow_path(@register_session),
                class: "inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" do %>
              <svg class="-ml-1 mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
              </svg>
              Registrar primer movimiento
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Bot√≥n volver -->
  <div class="mt-6">
    <%= link_to @register_session,
        class: "inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" do %>
      ‚Üê Volver al turno
    <% end %>
  </div>
</div>